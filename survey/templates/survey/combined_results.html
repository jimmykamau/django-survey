{% extends 'survey/base.html' %}
{% load i18n %}
{% load survey_extras %}

{% block body %}
    <h1> {{survey.name}} </h1>
    <div class="survey-description"> {{survey.description|safe}} </div>
    {% for category in categories %}
        <h3> {{category}} </h3>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th></th>
                    {% expr questions.filter(category=category).first().get_clean_choices() as choices %}
                    {% if choices %}
                        {% for choice in choices %}
                            <th>{{choice}}</th>
                        {% endfor %}
                        <th>Total</th>
                    {% else %}
                        <th></th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for question in questions %}
                    {% if question.category == category %}
                        <tr>
                            <td>{{question.text}}</td>
                            {% expr questions.filter(category=category).first().get_choices() as choices %}
                            {% if choices %}
                                {% for choice in choices %}
                                    {% expr answers.filter(question=question, body=choice[0]).count as resp %}
                                    <td>{{resp}}</td>
                                {% endfor %}
                                {% expr answers.filter(question=question).count as resp %}
                                <td>{{resp}}</td>
                            {% else %}
                                <td>
                                    {% for answer in answers %}
                                        {% if answer.question == question %}
                                            {{answer.body}}:::&nbsp;
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            {% endif %}
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}
{% endblock %}